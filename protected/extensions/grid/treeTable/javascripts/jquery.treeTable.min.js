(function(a){function f(a){for(var c=[];a=l(a);)c[c.length]=a[0];return c}function g(b){return a(b).siblings("tr."+c.childPrefix+b[0].id)}function m(a){a=parseInt(a[0].style.paddingLeft,10);return isNaN(a)?h:a}function j(b,e){var d=a(b.children("td")[c.treeColumn]);d[0].style.paddingLeft=m(d)+e+"px";g(b).each(function(){j(a(this),e)})}function k(b){if(!b.hasClass("initialized")){b.addClass("initialized");var e=g(b);!b.hasClass("parent")&&0<e.length&&b.addClass("parent");if(b.hasClass("parent")){var d=
a(b.children("td")[c.treeColumn]),f=m(d)+c.indent;e.each(function(){a(this).children("td")[c.treeColumn].style.paddingLeft=f+"px";a("#before-"+a(this).attr("id")).children("td");a("#after-"+a(this).attr("id")).children("td")[c.treeColumn].style.paddingLeft=f+"px"});if(c.expandable){e='<a href="#" title="'+c.stringExpand+'" style="margin-left: -'+c.indent+"px; padding-left: "+c.indent+'px" class="expander"></a>';c.clickableNodeNames?d.wrapInner(e):d.html(e+d.html());a(d[0].firstChild).click(function(){b.toggleBranch();
return!1}).mousedown(function(){return!1});a(d[0].firstChild).keydown(function(a){if(13==a.keyCode)return b.toggleBranch(),!1});c.clickableNodeNames&&(d[0].style.cursor="pointer",a(d).click(function(a){"expander"!=a.target.className&&b.toggleBranch()}));if(d=c.persist)try{d="1"==i.get(b.attr("id"))}catch(h){d=!1}d&&b.addClass("expanded");!b.hasClass("expanded")&&!b.hasClass("collapsed")&&b.addClass(c.initialState);b.hasClass("expanded")&&b.expand()}}}}function n(b,c){b.insertAfter(c);g(b).reverse().each(function(){n(a(this),
b[0])})}function l(b){for(var e=b[0].className.split(" "),d=0;d<e.length;d++)if(e[d].match(c.childPrefix))return a(b).siblings("#"+e[d].substring(c.childPrefix.length));return null}function p(a){if(a.hasClass("expanded"))try{i.set(a.attr("id"),"1")}catch(c){}else try{i.remove(a.attr("id"))}catch(d){}}var c,h,i;a.fn.treeTable=function(b){c=a.extend({},a.fn.treeTable.defaults,b);c.persist&&(i=new Persist.Store(c.persistStoreName));return this.each(function(){a(this).addClass("treeTable").find("tbody tr").each(function(){if(!a(this).hasClass("initialized")){var b=
-1==a(this)[0].className.search(c.childPrefix);b&&isNaN(h)&&(h=parseInt(a(a(this).children("td")[c.treeColumn]).css("padding-left"),10));!b&&(c.expandable&&"collapsed"==c.initialState)&&a(this).addClass("ui-helper-hidden");(!c.expandable||b)&&k(a(this))}})})};a.fn.treeTable.defaults={childPrefix:"child-of-",clickableNodeNames:!1,expandable:!0,indent:19,initialState:"collapsed",onNodeShow:null,onNodeHide:null,treeColumn:0,persist:!1,persistStoreName:"treeTable",stringExpand:"Expand",stringCollapse:"Collapse"};
a.fn.expandAll=function(){a(this).find("tr").each(function(){a(this).expand()})};a.fn.collapseAll=function(){a(this).find("tr").each(function(){a(this).collapse()})};a.fn.collapse=function(){return this.each(function(){a(this).removeClass("expanded").addClass("collapsed");c.persist&&p(a(this));g(a(this)).each(function(){a(this).hasClass("collapsed")||a(this).collapse();a(this).addClass("ui-helper-hidden");a.isFunction(c.onNodeHide)&&c.onNodeHide.call(this)})})};a.fn.expand=function(){return this.each(function(){a(this).removeClass("collapsed").addClass("expanded");
c.persist&&p(a(this));g(a(this)).each(function(){k(a(this));a(this).is(".expanded.parent")&&a(this).expand();a(this).removeClass("ui-helper-hidden");a.isFunction(c.onNodeShow)&&c.onNodeShow.call(this)})})};a.fn.reveal=function(){a(f(a(this)).reverse()).each(function(){k(a(this));a(this).expand().show()});return this};a.fn.appendBranchTo=function(b){var e=a(this),d=l(e),g=a.map(f(a(b)),function(a){return a.id});if(-1==a.inArray(e[0].id,g)&&(!d||b.id!=d[0].id)&&b.id!=e[0].id)j(e,-1*f(e).length*c.indent),
d&&e.removeClass(c.childPrefix+d[0].id),e.addClass(c.childPrefix+b.id),n(e,b),j(e,f(e).length*c.indent);return this};a.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments)};a.fn.toggleBranch=function(){a(this).hasClass("collapsed")?a(this).expand():a(this).collapse();return this};a.fn.refresh=function(){a(this).removeClass("initialized");a(this).reveal()}})(jQuery);