(function(a){a.fn.treeAble=function(i,g,d,j,h){var b=a(this);a(".items",b).treeTable(a.extend({initialState:"expanded"},d));d=a(".items tr.initialized",b);d.draggable(a.extend({helper:"clone",opacity:".75",refreshPositions:!0,revert:"invalid",revertDuration:300,scroll:!0},j));d.droppable({accept:".initialized",drop:function(d,c){a(c.draggable).appendBranchTo(this);a(this).refresh();var e="child",f=a(this).attr("id"),b=a(c.draggable).attr("id");g&&(a(this).hasClass("before")?(e="before",f=a(this).attr("id").replace("before-",
"")):a(this).hasClass("after")&&(e="after",f=a(this).attr("id").replace("after-","")),a.post(g,{type:e,to:f,moved:b}).error(function(a){alert("Error "+a.status+": "+a.responseText)}).complete(function(){a.fn.yiiGridView.update(i)}));a.isFunction(h)&&h(e,f,b)},hoverClass:"accept",over:function(b,c){this.id!==a(c.draggable.parents("tr")[0]).id&&!a(this).is(".expanded")&&a(this).expand();(a(this).hasClass("before")||a(this).hasClass("after"))&&a(this).children().find("div").toggleClass("accept",150)},
out:function(){(a(this).hasClass("before")||a(this).hasClass("after"))&&a(this).children().find("div").toggleClass("accept",100)},activate:function(b,c){a(".after, .before").not(a(c.draggable).prev()).not(a(c.draggable).next()).css("display","table-row")},deactivate:function(){a(".after, .before").css("display","none")}});a(".items tbody tr",b).mousedown(function(){a("tr.selected").removeClass("selected");a(this).addClass("selected")})}})(jQuery);